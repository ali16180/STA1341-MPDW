---
title: "Kuis Sesi UTS PADK"
author: "Muhammad Hafiz Fazli"
date: "`r Sys.Date()`"
output:
  html_document:
    theme:
      version: 4
      bg: "#2D2A2E"  # Monokai soft dark gray background
      fg: "#E3E3E3"  # Soft light gray text
      primary: "#A6E22E"  # Monokai green for highlights (links, buttons)
      secondary: "#FD971F"  # Monokai orange for secondary elements
      base_font: {google: "Fira Code"}  # Monospace font for clean look
    toc: true
    toc_float: true
    number_sections: false
    code_folding: show
    highlight: espresso  # Works best with dark backgrounds
---

```{r}
set.seed(1618)
library(TSA)
```

# Proses MA(2): theta1 = 0.4, theta2 = 0.6

## Pembangkitan Data

### Manual

```{r}
n <- 300
theta1 <- 0.4
theta2 <- 0.6

wn <- rnorm(n + 2, mean = 0, sd = 1)

ma2 <- numeric(n)
ma2[1] <- wn[3] + theta1 * wn[2] + theta2 * wn[1]
ma2[2] <- wn[4] + theta1 * wn[3] + theta2 * wn[2]

for(i in 3:n){
  ma2[i] <- wn[i+2] + theta1 * wn[i+1] + theta2 * wn[i]
}

ma2
```

### Dengan `arima.sim`

```{r}
ma2_sim <- arima.sim(list(order = c(0,0,2), ma = c(theta1, theta2)), n = n)
ma2_sim
```

## Plot Time Series, ACF, PACF, dan EACF

### Plot Time Series

```{r}
ts.plot(ma2, main = "MA(2) Manual - Time Series", ylab = "Y_t")
```

> Berdasarkan plot time series, terlihat bahwa data MA(2) yang dibangkitkan stasioner dalam rataan karena nilai-nilai berfluktuasi di sekitar rata-rata tetap dan tidak menunjukkan adanya tren naik atau turun jangka panjang.

### Plot ACF

```{r}
acf(ma2, lag.max = 20, main = "MA(2) Manual - ACF")
```

> Berdasarkan plot ACF tersebut, terlihat bahwa plot ACF cut off sampai lag kedua, sesuai dengan karakteristik proses MA(2). Setelah lag kedua, nilai autokorelasi turun mendekati nol.

### Plot PACF

```{r}
pacf(ma2, main = "MA(2) Manual - PACF")
```

> Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cenderung tails off dan membentuk gelombang sinus, sesuai dengan karakteristik proses MA.

### Plot EACF

```{r}
TSA::eacf(ma2)
```

> Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol muncul pada ordo AR(0) dan ordo MA(2), konsisten dengan model MA(2).

## Scatterplot Lag dan Autokorelasi

### Yt vs Yt-1

```{r}
yt_ma2 <- ma2[-1]

yt_1_ma2 <- ma2[-300]

plot(y = yt_ma2, x = yt_1_ma2,
     main = "Scatterplot Yt vs Yt-1 (MA(2))",
     xlab = "Y_{t-1}", ylab = "Y_t")

cor(yt_ma2, yt_1_ma2)
```

Secara teoritis, autokorelasi lag-1 untuk MA(2) adalah:

$$
\rho_1 = \frac{\theta_1 + \theta_1 \theta_2}{1 + \theta_1^2 + \theta_2^2}
= \frac{0.4 + (0.4 \times 0.6)}{1 + 0.4^2 + 0.6^2}
= \frac{0.64}{1.52}
\approx 0.421
$$

Nilai korelasi dari simulasi (0.360) cukup mendekati nilai teoritis 0.421.

### Yt vs Yt-2

```{r}
yt_ma2 <- ma2[-c(1,2)]

yt_2_ma2 <- ma2[-c(299,300)]

plot(y = yt_ma2, x = yt_2_ma2,
     main = "Scatterplot Yt vs Yt-2 (MA(2))",
     xlab = "Y_{t-2}", ylab = "Y_t")

cor(yt_ma2, yt_2_ma2)
```

Secara teoritis, autokorelasi lag-2 untuk MA(2) adalah:

$$
\rho_2 = \frac{\theta_2}{1 + \theta_1^2 + \theta_2^2}
= \frac{0.6}{1 + 0.4^2 + 0.6^2}
= \frac{0.6}{1.52}
\approx 0.395
$$

Nilai korelasi dari simulasi (0.384) cukup mendekati nilai teoritis 0.395.

### Yt vs Yt-3

```{r}
yt_ma2 <- ma2[-c(1,2,3)]

yt_3_ma2 <- ma2[-c(298,299,300)]

plot(y = yt_ma2, x = yt_3_ma2,
     main = "Scatterplot Yt vs Yt-3 (MA(2))",
     xlab = "Y_{t-3}", ylab = "Y_t")

cor(yt_ma2, yt_3_ma2)
```

Secara teoritis, autokorelasi lag-3 untuk MA(2) adalah 0, karena MA(2) hanya memiliki autokorelasi hingga lag 2.

Nilai korelasi dari simulasi (-0.069) cukup mendekati nilai teoritis 0.

------------------------------------------------------------------------

# Proses AR(2): phi1 = 0.5, phi2 = 0.2

## Pembangkitan Data

### Manual

```{r}
n <- length(wn)
n

ar2 <- c(1:n) 
ar2[1] <- wn[1]
ar2[2] <- wn[2] + 0.5*ar2[1]

for (i in 3:n) {
  ar2[i] <- wn[i] + 0.5*ar2[i-1] + 0.2*ar2[i-2]
}

ar2
```

### Dengan `arima.sim`

```{r ar2-sim}
ar2_sim <- arima.sim(list(order = c(2,0,0), ar = c(0.5, 0.2)), n = 200)
ar2_sim
```

## Plot Time Series, ACF, PACF, dan EACF

### Plot Time Series

```{r}
ts.plot(ar2, main = "AR(2) Manual - Time Series", ylab = "Y_t")
```

> Berdasarkan plot time series, terlihat bahwa data AR(2) yang dibangkitkan stasioner dalam rataan karena nilai-nilai berfluktuasi di sekitar rata-rata tetap dan tidak menunjukkan adanya tren naik atau turun jangka panjang.

### Plot ACF

```{r}
acf(ar2, lag.max = 20, main = "AR(2) Manual - ACF")
```

> Berdasarkan plot ACF tersebut, terlihat bahwa plot ACF cenderung tails off dan membentuk gelombang sinus, sesuai dengan karakteristik proses AR.

### Plot PACF

```{r}
pacf(ar2, main = "AR(2) Manual - PACF")
```

> Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cut off sampai lag kedua, sesuai dengan karakteristik proses AR(2). Setelah lag kedua, nilai parsial autokorelasi turun mendekati nol.

### Plot EACF

```{r}
TSA::eacf(ar2)
```

> Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol muncul pada ordo AR(2) dan ordo MA(0), konsisten dengan model AR(2).

## Scatterplot Lag dan Autokorelasi

### Yt vs Yt-1

```{r}
yt_ar2 <- ar2[-1]
yt_1_ar2 <- ar2[-200]

plot(y = yt_ar2, x = yt_1_ar2,
     main = "Scatterplot Yt vs Yt-1 (AR(2))",
     xlab = "Y_{t-1}", ylab = "Y_t")

cor(yt_ar2, yt_1_ar2)
```

Secara teoritis, autokorelasi lag-1 untuk AR(2) adalah:

$$
\rho_1 = \frac{\phi_1}{1 - \phi_2}
= \frac{0.5}{1 - 0.2}
= \frac{0.5}{0.8}
= 0.625
$$

Nilai korelasi dari simulasi (0.673) cukup mendekati nilai teoritis 0.625.

### Yt vs Yt-2

```{r}
yt_ar2 <- ar2[-c(1,2)]
yt_2_ar2 <- ar2[-c(199,200)]

plot(y = yt_ar2, x = yt_2_ar2,
     main = "Scatterplot Yt vs Yt-2 (AR(2))",
     xlab = "Y_{t-2}", ylab = "Y_t")

cor(yt_ar2, yt_2_ar2)
```

Secara teoritis, autokorelasi lag-2 untuk AR(2) adalah:

$$
\rho_2 = \phi_1 \rho_1 + \phi_2
= 0.5 \times 0.625 + 0.2
= 0.3125 + 0.2
= 0.5125
$$

Nilai korelasi dari simulasi (0.614) cukup mendekati nilai teoritis 0.5125.

### Yt vs Yt-3

```{r}
yt_ar2 <- ar2[-c(1,2,3)]
yt_3_ar2 <- ar2[-c(198,199,200)]

plot(y = yt_ar2, x = yt_3_ar2,
     main = "Scatterplot Yt vs Yt-3 (AR(2))",
     xlab = "Y_{t-3}", ylab = "Y_t")

cor(yt_ar2, yt_3_ar2)
```

Secara teoritis, autokorelasi lag-3 untuk AR(2) adalah:

$$
\rho_3 = \phi_1 \rho_2 + \phi_2 \rho_1
= 0.5 \times 0.5125 + 0.2 \times 0.625
= 0.25625 + 0.125
= 0.38125
$$

Nilai korelasi dari simulasi (0.498) cukup mendekati nilai teoritis 0.38125.

------------------------------------------------------------------------

# Proses ARMA(2,2): phi1 = 0.5, phi2 = 0.2, theta1 = 0.4, theta2 = 0.6

## Pembangkitan Data

### Manual

```{r}
arma.sim <- function(n, macoef, arcoef){
  manum <- length(macoef)
  arnum <- length(arcoef)
  stopifnot(manum < n & arnum < n)
  
  wn <- rnorm(n, sd = 0.5)
  init <- max(manum, arnum)

  arma <- wn[1:init]
  for(i in {init+1}:n){
   mastart <- i - manum
   maend <- i-1
   arstart <- i - arnum
   arend <- i-1
   arma[i] <- sum(arcoef * arma[arstart:arend]) + sum(macoef * wn[mastart:maend])  + wn[i]
   }
  return(arma)
}

n <- 300
phi  <- c(0.5, 0.2)
theta <- c(0.4, 0.6)

arma22 <- arma.sim(n = n, macoef = theta, arcoef = phi)
arma22
```

### Dengan `arima.sim`

```{r}
arma22_sim <- arima.sim(list(order = c(2,0,2), ar = phi, ma = theta), n = n)
arma22_sim
```

## Plot Time Series, ACF, PACF, dan EACF

### Plot Time Series

```{r}
plot.ts(arma22, main = "ARMA(2,2) Manual - Time Series", ylab = "Y_t")
```

> Berdasarkan plot time series, terlihat bahwa data ARMA(2,2) yang dibangkitkan stasioner dalam rataan karena nilai-nilai berfluktuasi di sekitar rata-rata tetap dan tidak menunjukkan adanya tren naik atau turun jangka panjang.

### Plot ACF

```{r}
acf(arma22, lag.max = 20, main = "ARMA(2,2) Manual - ACF")
```

> Berdasarkan plot ACF tersebut, terlihat bahwa plot ACF cenderung tails off dan membentuk gelombang sinus, sesuai dengan karakteristik proses ARMA.

### Plot PACF

```{r}
pacf(arma22, main = "ARMA(2,2) Manual - PACF")
```

> Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cenderung tails off dan membentuk gelombang sinus, sesuai dengan karakteristik proses ARMA.

### Plot EACF

```{r}
TSA::eacf(arma22)
```

> Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol muncul pada ordo AR(2) dan ordo MA(2), konsisten dengan model ARMA(2,2).

## Scatterplot Lag dan Autokorelasi

### Yt vs Yt-1

```{r}
yt_arma22 <- arma22[-1]
yt_1_arma22 <- arma22[-300]

plot(y = yt_arma22, x = yt_1_arma22,
     main = "Scatterplot Yt vs Yt-1 (ARMA(2,2))",
     xlab = "Y_{t-1}", ylab = "Y_t")

cor(yt_arma22, yt_1_arma22)
```

Secara teoritis, autokorelasi lag-1 untuk ARMA(2,2) adalah:

Kita gunakan persamaan autokovarians ARMA(2,2) (dengan σ\^2 = 1 karena akan saling meniadakan pada rasio ρ_k = γ_k/γ_0):

$$
\begin{aligned}
\gamma_0 &= \phi_1 \gamma_1 + \phi_2 \gamma_2 + (1+\theta_1^2+\theta_2^2),\\
\gamma_1 &= \phi_1 \gamma_0 + \phi_2 \gamma_1 + (\theta_1+\theta_1\theta_2),\\
\gamma_2 &= \phi_1 \gamma_1 + \phi_2 \gamma_0 + (\theta_2),
\end{aligned}
$$ dengan $\phi_1=0.5,\ \phi_2=0.2,\ \theta_1=0.4,\ \theta_2=0.6$.

Hitung konstanta: $$
1+\theta_1^2+\theta_2^2 = 1+0.4^2+0.6^2 = 1.52,\quad
\theta_1+\theta_1\theta_2 = 0.4+0.4\cdot 0.6 = 0.64,\quad
\theta_2=0.6.
$$

Substitusi dan selesaikan bertahap: $$
\begin{aligned}
\gamma_1 &= 0.5\,\gamma_0 + 0.2\,\gamma_1 + 0.64 
\ \Rightarrow\ 0.8\,\gamma_1 = 0.5\,\gamma_0 + 0.64 
\ \Rightarrow\ \gamma_1 = 0.625\,\gamma_0 + 0.8,\\[4pt]
\gamma_2 &= 0.5\,\gamma_1 + 0.2\,\gamma_0 + 0.6
= 0.5(0.625\,\gamma_0 + 0.8) + 0.2\,\gamma_0 + 0.6
= 0.5125\,\gamma_0 + 1.0,\\[4pt]
\gamma_0 &= 0.5\,\gamma_1 + 0.2\,\gamma_2 + 1.52
= 0.5(0.625\,\gamma_0 + 0.8) + 0.2(0.5125\,\gamma_0 + 1.0) + 1.52\\
&= 0.415\,\gamma_0 + 2.12
\ \Rightarrow\ (1-0.415)\gamma_0 = 2.12
\ \Rightarrow\ \gamma_0 = \frac{2.12}{0.585} = \frac{424}{117} \approx 3.62393,\\[4pt]
\gamma_1 &= 0.625\,\gamma_0 + 0.8 = 0.625\cdot \frac{424}{117} + 0.8
= \frac{1793}{585} \approx 3.06496.
\end{aligned}
$$

Maka $$
\rho_1 = \frac{\gamma_1}{\gamma_0}
= \frac{1793/585}{424/117}
\approx 0.8458.
$$

Nilai korelasi dari simulasi (0.830) cukup mendekati nilai teoritis 0.8458

### Yt vs Yt-2

```{r}
yt_arma22 <- arma22[-c(1,2)]
yt_2_arma22 <- arma22[-c(299,300)]

plot(y = yt_arma22, x = yt_2_arma22,
     main = "Scatterplot Yt vs Yt-2 (ARMA(2,2))",
     xlab = "Y_{t-2}", ylab = "Y_t")

cor(yt_arma22, yt_2_arma22)
```

Secara teoritis, autokorelasi lag-2 untuk ARMA(2,2) adalah:

Gunakan persamaan autokovarians ARMA(2,2) (ambil sigma\^2 = 1 karena akan saling meniadakan pada rasio $\rho_k=\gamma_k/\gamma_0$):

$$
\begin{aligned}
\gamma_0 &= \phi_1 \gamma_1 + \phi_2 \gamma_2 + (1+\theta_1^2+\theta_2^2),\\
\gamma_1 &= \phi_1 \gamma_0 + \phi_2 \gamma_1 + (\theta_0\theta_1+\theta_1\theta_2),\\
\gamma_2 &= \phi_1 \gamma_1 + \phi_2 \gamma_0 + (\theta_0\theta_2),
\end{aligned}
$$ dengan $\theta_0=1$ dan $\phi_1=0.5,\ \phi_2=0.2,\ \theta_1=0.4,\ \theta_2=0.6$.

Hitung konstanta: $$
1+\theta_1^2+\theta_2^2 = 1+0.4^2+0.6^2 = 1.52,\quad
\theta_0\theta_1+\theta_1\theta_2 = 0.4+0.4\cdot 0.6 = 0.64,\quad
\theta_0\theta_2=0.6.
$$

Substitusi dan selesaikan bertahap: $$
\begin{aligned}
\gamma_1 &= 0.5\,\gamma_0 + 0.2\,\gamma_1 + 0.64
\ \Rightarrow\ \gamma_1 = 0.625\,\gamma_0 + 0.8,\\[4pt]
\gamma_2 &= 0.5\,\gamma_1 + 0.2\,\gamma_0 + 0.6
= 0.5(0.625\,\gamma_0 + 0.8) + 0.2\,\gamma_0 + 0.6
= 0.5125\,\gamma_0 + 1.0,\\[4pt]
\gamma_0 &= 0.5\,\gamma_1 + 0.2\,\gamma_2 + 1.52
= 0.415\,\gamma_0 + 2.12
\ \Rightarrow\ \gamma_0 = \frac{2.12}{0.585} = \frac{424}{117}.
\end{aligned}
$$

Maka $$
\gamma_2 = 0.5125\,\gamma_0 + 1
= \frac{41}{80}\cdot \frac{424}{117} + 1
= \frac{3343}{1170},
\quad
\rho_2 = \frac{\gamma_2}{\gamma_0}
= \frac{\tfrac{3343}{1170}}{\tfrac{424}{117}}
= \frac{3343}{4240}
\approx 0.7884.
$$

Nilai korelasi dari simulasi (0.792) cukup mendekati nilai teoritis 0.7884

### Yt vs Yt-3

```{r}
yt_arma22 <- arma22[-c(1,2,3)]
yt_3_arma22 <- arma22[-c(298,299,300)]

plot(y = yt_arma22, x = yt_3_arma22,
     main = "Scatterplot Yt vs Yt-3 (ARMA(2,2))",
     xlab = "Y_{t-3}", ylab = "Y_t")

cor(yt_arma22, yt_3_arma22)
```

Secara teoritis, autokorelasi lag-3 untuk ARMA(2,2) adalah:

Gunakan persamaan autokovarians ARMA(2,2) (ambil σ² = 1 karena akan saling meniadakan pada rasio $\rho_k=\gamma_k/\gamma_0$):

$$
\begin{aligned}
\gamma_0 &= \phi_1 \gamma_1 + \phi_2 \gamma_2 + (1+\theta_1^2+\theta_2^2),\\
\gamma_1 &= \phi_1 \gamma_0 + \phi_2 \gamma_1 + (\theta_1+\theta_1\theta_2),\\
\gamma_2 &= \phi_1 \gamma_1 + \phi_2 \gamma_0 + (\theta_2),
\end{aligned}
$$ dengan $\phi_1=0.5,\ \phi_2=0.2,\ \theta_1=0.4,\ \theta_2=0.6$.

Dari tiga persamaan di atas diperoleh (tepat dalam pecahan): $$
\gamma_0=\frac{424}{117},\quad
\gamma_1=\frac{1793}{585},\quad
\gamma_2=\frac{3343}{1170}.
$$

Karena $3>q$, maka untuk $k=3$ tidak ada suku MA: $$
\gamma_3=\phi_1\gamma_2+\phi_2\gamma_1
= \tfrac{1}{2}\cdot \tfrac{3343}{1170} + \tfrac{1}{5}\cdot \tfrac{1793}{585}
= \frac{23887}{11700}.
$$

Maka $$
\rho_3=\frac{\gamma_3}{\gamma_0}
= \frac{\tfrac{23887}{11700}}{\tfrac{424}{117}}
= \frac{23887}{42400}
\approx 0.56336.
$$

Nilai korelasi dari simulasi (0.613) cukup mendekati nilai teoritis 0.56336
