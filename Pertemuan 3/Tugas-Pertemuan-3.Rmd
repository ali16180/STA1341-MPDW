---
title: "Perbandingan Model Koyck, DLM, dan ARDL pada Data AQI"
author: "Muhammad Hafiz Fazli"
date: "`r Sys.Date()`"
output:
  html_document:
    theme:
      version: 4
      bg: "#2D2A2E"
      fg: "#E3E3E3"
      primary: "#A6E22E"
      secondary: "#FD971F"
      base_font: {google: "Fira Code"}
    toc: true
    toc_float: true
    number_sections: false
    code_folding: show
    highlight: espresso
---

---

Tugas Pertemuan 3, MPDW-STA1341

Muhammad Hafiz Fazli - G1401231081

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Import Data & Split Data
```{r}
library(readr)

df <- read_csv("NewDelhi_Air_quality.csv")
df
```

```{r}
df <- dplyr::select(df, CO, AQI)
df
```

```{r}
n <- nrow(df)
cut <- floor(0.8 * n)

train <- as.data.frame(df[1:cut, ])
test  <- as.data.frame(df[(cut+1):n, ])

nrow(train); nrow(test)
```

# Model Koyck
### Modelling
```{r}
library(dLagM)

model.koyck <- koyckDlm(x = train$CO, y = train$AQI)
summary(model.koyck)
```

### Persamaan Model
\[
AQI_t = 2.84 \;+\; 0.898 \cdot AQI_{t-1} \;-\; 0.00076 \cdot CO_t \;+\; \varepsilon_t
\]

***

### Kesimpulan
Secara **individu**, variabel \(AQI_{t-1}\) (lag AQI) signifikan kuat terhadap \(AQI_t\) (\(p < 0.001\)), sedangkan \(CO_t\) sama sekali tidak signifikan (\(p = 0.989\)).  

Secara **keseluruhan**, model signifikan (uji Wald, \(p < 2.2 \times 10^{-16}\)) dengan nilai **R² = 0.818** (adjusted R² = 0.811). Artinya, model mampu menjelaskan sekitar 81.8% variasi AQI.  

Jadi, meskipun CO tidak punya pengaruh berarti, keberadaan lag AQI menjelaskan sebagian besar variasi AQI saat ini. Model ini menunjukkan bahwa nilai AQI sekarang terutama dipengaruhi oleh nilai AQI sebelumnya.

***

### Forecasting & MAPE

```{r}
fore.koyck <- dLagM::forecast(model.koyck, x = test$CO, h = 15)
fore.koyck

actual <- test$AQI
predicted <- fore.koyck$forecasts

mape.koyck <- mean(abs((actual - predicted) / actual)) * 100
mape.koyck
```
> MAPE = 18.48%

# Regression with Distributed Lag

### Menentukan Lag Optimum
```{r}
fdlm.auto <- finiteDLMauto(
  formula    = AQI ~ CO,
  data       = train,
  q.min      = 1,
  q.max      = 10,
  model.type = "dlm",
  error.type = "AIC",
  trace      = TRUE
)

fdlm.auto
```
> Lag optimum = 10

### Modelling
```{r}
model.dlm <- dlm(
  x = train$CO,
  y = train$AQI,
  q = 10
)

summary(model.dlm)
```

### Persamaan Model
\[
AQI_t = -51.33 \;+\; 0.443 \cdot CO_t \;+\; 0.212 \cdot CO_{t-1} \;-\; 0.135 \cdot CO_{t-2} 
\;+\; 0.055 \cdot CO_{t-3} \;+\; 0.095 \cdot CO_{t-4} \;-\; 0.287 \cdot CO_{t-5} 
\;+\; 0.056 \cdot CO_{t-6} \;+\; 0.067 \cdot CO_{t-7} \;-\; 0.142 \cdot CO_{t-8} 
\;-\; 0.042 \cdot CO_{t-9} \;+\; 0.069 \cdot CO_{t-10} \;+\; \varepsilon_t
\]

***

### Kesimpulan
Secara **individu**, variabel \(CO_t\) (lag-0) signifikan kuat terhadap \(AQI_t\) (\(p < 0.001\)), sementara sebagian besar lag CO lainnya tidak signifikan. Lag ke-5 (\(CO_{t-5}\)) menunjukkan pengaruh negatif yang mendekati signifikan (\(p = 0.080\)).  

Secara **keseluruhan**, model signifikan (F-statistic, \(p < 0.001\)) dengan nilai **R² = 0.910** (adjusted R² = 0.882). Artinya, model mampu menjelaskan sekitar 91% variasi AQI.  

Nilai **AIC = 114.20** dan **BIC = 138.25** mendukung bahwa model dengan panjang lag 10 memiliki performa terbaik berdasarkan kriteria informasi.  

Model ini menunjukkan bahwa AQI terutama dipengaruhi oleh kadar CO saat ini, dengan indikasi bahwa lag CO tertentu (seperti lag-5) juga mungkin berperan. Namun, kontribusi lag-lag lain terhadap AQI relatif lemah.  

***

### Forecasting & MAPE
```{r}
fore.dlm <- dLagM::forecast(model.dlm, x = test$CO, h = 15)
fore.dlm

actual <- test$AQI
predicted <- fore.dlm$forecasts

mape.dlm <- mean(abs((actual - predicted) / actual)) * 100
mape.dlm
```
> MAPE = 11.37%

# Model Autoregressive Distributed Lag

### Menentukan Lag Optimum
```{r}
model.ardl.opt <- ardlBoundOrders(
  formula = AQI ~ CO,
  data    = train,
  ic      = "AIC"
)

model.ardl.opt
```
```{r}
min_p <- c()
for(i in 1:15){
  min_p[i] <- min(model.ardl.opt$Stat.table[[i]])
}

q_opt <- which(min_p == min(min_p, na.rm = TRUE))
p_opt <- which(model.ardl.opt$Stat.table[[q_opt]] == 
                 min(model.ardl.opt$Stat.table[[q_opt]], na.rm = TRUE))

data.frame(
  "q_optimum" = q_opt,
  "p_optimum" = p_opt, 
  "AIC"       = model.ardl.opt$min.Stat
)
```
> Lag optimum = (14, 14) (14 lag AQI, 14 lag CO)

### Modelling
```{r}
model.ardl <- ardlDlm(
  formula = AQI ~ CO,
  data    = train,
  p       = 14,
  q       = 14
)
summary(model.ardl)
```

### Persamaan Model
\[ \begin{aligned} AQI_t = & -50.09 + 0.192 \cdot CO_t + 0.179 \cdot CO_{t-1} - 0.151 \cdot CO_{t-2} + 0.082 \cdot CO_{t-3} + 0.075 \cdot CO_{t-4} - 0.164 \cdot CO_{t-5} + 0.202 \cdot CO_{t-6} + 0.022 \cdot CO_{t-7} \\ & - 0.169 \cdot CO_{t-8} - 0.018 \cdot CO_{t-9} + 0.138 \cdot CO_{t-10} - 0.156 \cdot CO_{t-11} - 0.099 \cdot CO_{t-12} + 0.091 \cdot CO_{t-13} + 0.116 \cdot CO_{t-14} \\ & + 0.519 \cdot AQI_{t-1} + 0.300 \cdot AQI_{t-2} - 0.010 \cdot AQI_{t-3} - 0.225 \cdot AQI_{t-4} - 0.107 \cdot AQI_{t-5} - 0.272 \cdot AQI_{t-6} \\ & - 0.071 \cdot AQI_{t-7} + 0.043 \cdot AQI_{t-8} + 0.079 \cdot AQI_{t-9} + 0.135 \cdot AQI_{t-10} + 0.011 \cdot AQI_{t-11} + 0.143 \cdot AQI_{t-12} + 0.116 \cdot AQI_{t-13} - 0.322 \cdot AQI_{t-14} + \varepsilon_t \end{aligned} \]

***

### Kesimpulan
Secara **individu**, sebagian besar koefisien lag CO maupun AQI tidak signifikan. Hanya **intercept** (\(p = 0.059\), mendekati signifikan) dan lag pertama dari AQI (\(AQI_{t-1}\), \(p = 0.093\)) yang menunjukkan indikasi pengaruh.  

Secara **keseluruhan**, model signifikan (F-statistic = 17.61, \(p < 0.001\)) dengan nilai **R² = 0.975** (adjusted R² = 0.920). Artinya, model mampu menjelaskan sekitar 97.5% variasi AQI, meskipun sebagian besar kontribusi individu lag tidak signifikan.  

Model ini menunjukkan bahwa AQI saat ini sangat dipengaruhi oleh kombinasi panjang lag dari CO dan AQI, dengan indikasi bahwa nilai AQI sebelumnya (khususnya lag-1) memiliki peran penting dalam menjelaskan variasi AQI saat ini.  

***

### Forecasting & MAPE
```{r}
fore.ardl <- dLagM::forecast(model.ardl, x = test$CO, h = 15)
fore.ardl

actual <- test$AQI
predicted <- fore.ardl$forecasts

mape.ardl <- mean(abs((actual - predicted) / actual)) * 100
mape.ardl
```
> MAPE = 8.90%

# Perbandingan Performa Model
```{r}
akurasi <- matrix(c(mape.koyck, mape.dlm, mape.ardl))
row.names(akurasi) <- c("Koyck", "DLM", "ARDL")
colnames(akurasi) <- c("MAPE")

akurasi
```

### Kesimpulan Akhir

Berdasarkan nilai **MAPE**, akurasi ketiga model dapat dibandingkan sebagai berikut:

- **Koyck**: 18.48%  
- **DLM**: 11.37%  
- **ARDL**: 8.90%  

Model dengan nilai MAPE terendah adalah **ARDL**, sehingga dapat disimpulkan bahwa model ARDL memberikan performa prediksi terbaik dibandingkan model Koyck maupun DLM. Dengan kata lain, ARDL lebih mampu menjelaskan dan memprediksi variasi AQI berdasarkan data CO.  

Kemungkinan alasannya adalah karena **ARDL memasukkan lag dari variabel dependen (AQI) sekaligus lag panjang dari variabel independen (CO)**. Hal ini memungkinkan ARDL menangkap baik efek jangka pendek maupun jangka panjang secara lebih fleksibel, sehingga mampu memberikan estimasi yang lebih akurat dibandingkan Koyck (yang hanya mengasumsikan penurunan geometris) maupun DLM (yang terbatas pada lag finite tanpa struktur autoregresif).
